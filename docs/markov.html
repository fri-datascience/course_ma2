<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Markov Chains | Mathematics 2 - exercises</title>
  <meta name="description" content="Course notes" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Markov Chains | Mathematics 2 - exercises" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://fri-datascience.github.io/course_ma2/" />
  
  <meta property="og:description" content="Course notes" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Markov Chains | Mathematics 2 - exercises" />
  
  <meta name="twitter:description" content="Course notes" />
  

<meta name="author" content="Erik Štrumbelj, Gašper Fijavž, and Žiga Virk" />


<meta name="date" content="2021-04-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="montecarlo.html"/>
<link rel="next" href="MCMC.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mathematics 2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="gradient.html"><a href="gradient.html"><i class="fa fa-check"></i><b>1</b> Gradient-based methods</a><ul>
<li class="chapter" data-level="1.1" data-path="gradient.html"><a href="gradient.html#theoretical-problems"><i class="fa fa-check"></i><b>1.1</b> Theoretical problems</a></li>
<li class="chapter" data-level="1.2" data-path="gradient.html"><a href="gradient.html#practical-problems"><i class="fa fa-check"></i><b>1.2</b> Practical problems</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="NA.html"><a href="NA.html"><i class="fa fa-check"></i><b>2</b> NA</a><ul>
<li class="chapter" data-level="2.1" data-path="NA.html"><a href="NA.html#th02"><i class="fa fa-check"></i><b>2.1</b> Theoretical problems</a></li>
<li class="chapter" data-level="2.2" data-path="NA.html"><a href="NA.html#pr02"><i class="fa fa-check"></i><b>2.2</b> Practical problems</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="montecarlo.html"><a href="montecarlo.html"><i class="fa fa-check"></i><b>3</b> Monte Carlo</a></li>
<li class="chapter" data-level="4" data-path="markov.html"><a href="markov.html"><i class="fa fa-check"></i><b>4</b> Markov Chains</a></li>
<li class="chapter" data-level="5" data-path="MCMC.html"><a href="MCMC.html"><i class="fa fa-check"></i><b>5</b> Markov Chain Monte Carlo</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mathematics 2 - exercises</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="markov" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Markov Chains</h1>
<style>
.fold-btn { 
  float: right; 
  margin: 5px 5px 0 0;
}
.fold { 
  border: 1px solid black;
  min-height: 40px;
}
</style>
<script type="text/javascript">
$(document).ready(function() {
  $folds = $(".fold");
  $folds.wrapInner("<div class=\"fold-blck\">"); // wrap a div container around content
  $folds.prepend("<button class=\"fold-btn\">Unfold Solution</button>");  // add a button
  $(".fold-blck").toggle();  // fold all blocks
  $(".fold-btn").on("click", function() {  // add onClick event
    $(this).text($(this).text() === "Fold Solution" ? "Unfold Solution" : "Fold Solution");  // if the text equals "Fold", change it to "Unfold"or else to "Fold" 
    $(this).next(".fold-blck").toggle("linear");  // "swing" is the default easing function. This can be further customized in its speed or the overall animation itself.
  })
});
</script>

<div class="exercise">
<p><span id="exr:unnamed-chunk-2" class="exercise"><strong>Exercise 4.1  (Global behavior from local rules)  </strong></span>We are are going to move on the [0,1] interval by starting somewhere and then applying different rules to determine the next position. These rules will be local in the sense that they will depend only on the current position. In other words, we are going to simulate Markov Chains with a continuous state space.</p>
<p>For each of the below local rules separately try to guess what the long run distribution of visited states will look like. Does it depend on where we start? Then pick a starting point on <span class="math inline">\([0,1]\)</span> and simulate 100000 steps and plot the histogram. Does it match your guess? Does the histogram depend on where you started?</p>
<ol style="list-style-type: lower-alpha">
<li><strong>Uniform proposal:</strong> <span class="math inline">\(x_\text{next} \sim U(x_\text{current} - 0.1, x_\text{current} + 0.1)\)</span> and we bounce if we would jump to less than 0 or more than 1. For example, if we would jump to <span class="math inline">\(1 + x\)</span>, we instead replace that with a jump to <span class="math inline">\(1 - x\)</span>, and if we would jump to <span class="math inline">\(-x\)</span>, we instead jump to <span class="math inline">\(x\)</span>.</li>
<li><strong>Normal proposal:</strong> <span class="math inline">\(x_\text{next} \sim N(\mu = x_\text{current}, \sigma = 0.1)\)</span> and we bounce if we would jump to less than 0 or more than 1. For example, if we would jump to <span class="math inline">\(1 + x\)</span>, we instead replace that with a jump to <span class="math inline">\(1 - x\)</span>, and if we would jump to <span class="math inline">\(-x\)</span>, we instead jump to <span class="math inline">\(x\)</span>.</li>
<li><strong>Uniform proposal with teleport on one side:</strong> <span class="math inline">\(x_\text{next} \sim U(x_\text{current} - 0.1, x_\text{current} + 0.1)\)</span> and we bounce if we would jump to less than 0. For example, if we would jump to <span class="math inline">\(-x\)</span>, we instead replace that with a jump to <span class="math inline">\(x\)</span>. If we would jump to more than 1, however, we now teleport to the left. That is if we would jump to <span class="math inline">\(1 + x\)</span>, we instead jump to <span class="math inline">\(x\)</span>.</li>
<li><strong>Asymmetric uniform proposal:</strong> <span class="math inline">\(x_\text{next} \sim U(x_\text{current} - 0.1, x_\text{current} + 0.11)\)</span> and we bounce if we would jump to less than 0 or more than 1. For example, if we would jump to <span class="math inline">\(1 + x\)</span>, we instead replace that with a jump to <span class="math inline">\(1 - x\)</span>, and if we would jump to <span class="math inline">\(-x\)</span>, we instead jump to <span class="math inline">\(x\)</span>.</li>
<li><strong>Tendency to <span class="math inline">\(\frac{1}{2}\)</span>:</strong> <span class="math inline">\(x_\text{next} \sim U(x_\text{current} - 0.1, x_\text{current} + 0.12)\)</span> if <span class="math inline">\(x_\text{current} &lt; 0.5\)</span> and <span class="math inline">\(x_\text{next} \sim U(x_\text{current} - 0.12, x_\text{current} + 0.1)\)</span> otherwise. $We bounce if we would jump to less than 0 or more than 1. For example, if we would jump to <span class="math inline">\(1 + x\)</span>, we instead replace that with a jump to <span class="math inline">\(1 - x\)</span>, and if we would jump to <span class="math inline">\(-x\)</span>, we instead jump to <span class="math inline">\(x\)</span>.
</div>
</li>
</ol>
<div class="fold">

<div class="solution">
 <span class="solution"><em>Solution. </em></span>  First, we write the function that we will use to move around.
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">move &lt;-<span class="st"> </span><span class="cf">function</span>(my_rule, <span class="dt">start =</span> <span class="fl">0.5</span>, <span class="dt">seed =</span> <span class="dv">0</span>, <span class="dt">m =</span> <span class="dv">100000</span>) {
  <span class="kw">set.seed</span>(seed)
  x &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim =</span> m <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)
  x[<span class="dv">1</span>] &lt;-<span class="st"> </span>start
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {
    x[i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">my_rule</span>(x[i])
  }
  x
}</code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Uniform proposal:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule_A &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x_new &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, x <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span>, x <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>)
  <span class="cf">if</span> (x_new <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) x_new &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>x_new
  <span class="cf">if</span> (x_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) x_new &lt;-<span class="st"> </span><span class="dv">0</span> <span class="op">-</span><span class="st"> </span>x_new
  x_new
}

<span class="kw">hist</span>(<span class="kw">move</span>(rule_A))</code></pre></div>
<p><img src="bookdown-ma2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Normal proposal:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule_B &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x_new &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, x, <span class="fl">0.1</span>)
  <span class="cf">if</span> (x_new <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) x_new &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>x_new
  <span class="cf">if</span> (x_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) x_new &lt;-<span class="st"> </span><span class="dv">0</span> <span class="op">-</span><span class="st"> </span>x_new
  x_new
}

<span class="kw">hist</span>(<span class="kw">move</span>(rule_B))</code></pre></div>
<p><img src="bookdown-ma2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Uniform proposal with teleport on one side:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule_C &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x_new &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, x, <span class="fl">0.1</span>)
  <span class="cf">if</span> (x_new <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) x_new &lt;-<span class="st"> </span>x_new <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
  <span class="cf">if</span> (x_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) x_new &lt;-<span class="st"> </span><span class="dv">0</span> <span class="op">-</span><span class="st"> </span>x_new
  x_new
}

<span class="kw">hist</span>(<span class="kw">move</span>(rule_C))</code></pre></div>
<p><img src="bookdown-ma2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Asymmetric uniform proposal:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule_D &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x_new &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, x <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span>, x <span class="op">+</span><span class="st"> </span><span class="fl">0.11</span>)
  <span class="cf">if</span> (x_new <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) x_new &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>x_new
  <span class="cf">if</span> (x_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) x_new &lt;-<span class="st"> </span><span class="dv">0</span> <span class="op">-</span><span class="st"> </span>x_new
  x_new
}

<span class="kw">hist</span>(<span class="kw">move</span>(rule_D))</code></pre></div>
<p><img src="bookdown-ma2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Tendency to 0.5:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule_E &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>) {
    x_new &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, x <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span>, x <span class="op">+</span><span class="st"> </span><span class="fl">0.12</span>)
  } <span class="cf">else</span> {
    x_new &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, x <span class="op">-</span><span class="st"> </span><span class="fl">0.12</span>, x <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>)    
  }
  <span class="cf">if</span> (x_new <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) x_new &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>x_new
  <span class="cf">if</span> (x_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) x_new &lt;-<span class="st"> </span><span class="dv">0</span> <span class="op">-</span><span class="st"> </span>x_new
  x_new
}

<span class="kw">hist</span>(<span class="kw">move</span>(rule_E))</code></pre></div>
<p><img src="bookdown-ma2_files/figure-html/unnamed-chunk-9-1.png" width="672" /> ```</p>
</div>

<div class="exercise">
<p><span id="exr:unnamed-chunk-10" class="exercise"><strong>Exercise 4.2  (Properties of Markov Chains)  </strong></span>For each of the Markov chains defined below do the following:</p>
<ul>
<li>Find all communicating classes and show whether or not the chain is irreducible,</li>
<li>For each state determine its period and whether it is transient, positive recurrent or null recurrent.</li>
<li>Find all stationary distributions and show that there are no other stationary distributions.</li>
</ul>
<ol style="list-style-type: lower-alpha">
<li><p><span class="math display">\[K = \begin{bmatrix}
0 &amp; \frac{4}{5} &amp; 0 &amp; \frac{1}{5} &amp; 0 \\[0.1em]
\frac{1}{4} &amp; 0 &amp; \frac{1}{2} &amp; \frac{1}{4} &amp; 0 \\[0.1em]
0 &amp; \frac{1}{2} &amp; 0 &amp; \frac{1}{10} &amp; \frac{2}{5} \\[0.1em]
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\[0.1em]
\frac{1}{3} &amp; 0 &amp; \frac{1}{3} &amp; \frac{1}{3} &amp; 0
\end{bmatrix}.\]</span></p></li>
<li><p><span class="math display">\[K = \begin{bmatrix}
\frac{1}{10} &amp; \frac{2}{10} &amp; \frac{3}{10} &amp; \frac{4}{10} \\[0.1em]
0 &amp; \frac{5}{10} &amp; \frac{2}{10} &amp; \frac{3}{10} \\[0.1em]
0 &amp; 0 &amp; \frac{3}{10} &amp; \frac{7}{10} \\[0.1em]
0 &amp; 0 &amp; \frac{1}{10} &amp; \frac{9}{10} 
\end{bmatrix}.\]</span></p></li>
<li><p><span class="math display">\[K = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\[0.1em]
0 &amp; \frac{1}{2} &amp; \frac{1}{2} &amp; 0 \\[0.1em]
0 &amp; \frac{1}{2} &amp; \frac{1}{2} &amp; 0 \\[0.1em]
\frac{1}{2} &amp; 0 &amp; 0 &amp; \frac{1}{2} 
\end{bmatrix}.\]</span></p></li>
<li><p><span class="math inline">\(S = \mathbb{Z}\)</span> (integers). If we are in state <span class="math inline">\(z\)</span>, we have <span class="math inline">\(\frac{1}{2}\)</span> probability to move to <span class="math inline">\(z - 1\)</span> and <span class="math inline">\(\frac{1}{2}\)</span> probability to move to <span class="math inline">\(z + 1\)</span></p></li>
<li><span class="math inline">\(S = \mathbb{Z}\)</span>. If we are in state <span class="math inline">\(z &gt; 0\)</span>, we have <span class="math inline">\(\frac{4}{5}\)</span> probability to move to <span class="math inline">\(z - 1\)</span> and <span class="math inline">\(\frac{1}{5}\)</span> probability to move to <span class="math inline">\(z + 1\)</span>. If we are in state <span class="math inline">\(z &lt; 0\)</span>, we have <span class="math inline">\(\frac{4}{5}\)</span> probability to move to <span class="math inline">\(z + 1\)</span> and <span class="math inline">\(\frac{1}{5}\)</span> probability to move to <span class="math inline">\(z - 1\)</span>. If we are in <span class="math inline">\(z = 0\)</span>, we have equal probability to move to <span class="math inline">\(+1\)</span> or <span class="math inline">\(-1\)</span>.
</div>
</li>
</ol>
<div class="fold">

<div class="solution">
 <span class="solution"><em>Solution. </em></span>  a. If we plot a graph representation of non-zero transition probabilities, we can quickly identify communicating classes:
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(igraph)

am &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, 
               <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, 
               <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span> ,<span class="dv">1</span> ,<span class="dv">1</span>, 
               <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,
               <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">ncol =</span> <span class="dv">5</span>, <span class="dt">byrow =</span> T)

<span class="kw">plot</span>(<span class="kw">graph_from_adjacency_matrix</span>(am))</code></pre></div>
<p><img src="bookdown-ma2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>We can see that 1, 2, 3, and 5 communicate with eachother and 4 communicates only with itself. Therefore, we have two communicating classes and the chain is not irreducible. The class {4} clearly has a period of 1. The class {1, 2, 3, 5} has a period of 2. We can determine this by focusing on one state, for example 1, which can only be revisited in multiples of 2 (we can only return to 1 from 2 or from 5, but not from 3, therefore all possible return paths will be of length that is a multiple of 2). Because all states in a communicating class share the period, they all have a period of 2.</p>
<p>State {4} is clearly positive recurrent (it has a return time of 1). State {1} is transient, because we will sooner or later transition to {4} and never return to {1}. Therefore, all states in this communicating class are transient.</p>
<p>Given that all paths will eventually end up in state 4, only [0, 0, 0, 1, 0] can possibly be a stationary distribution. By multipling with the transition matrix, we can quickly check that it is indeed a stationary distribution. ```</p>
</div>

<div class="exercise">
<p><span id="exr:unnamed-chunk-13" class="exercise"><strong>Exercise 4.3  (Autocorrelation)  </strong></span>Consider these three Markov Chains with state space {1,2}:</p>
<p><span class="math display">\[K_1 = \begin{bmatrix}
0.9 &amp; 0.1  \\[0.1em]
0.1 &amp; 0.9
\end{bmatrix}.\]</span></p>
<p><span class="math display">\[K_2 = \begin{bmatrix}
0.5 &amp; 0.5  \\[0.1em]
0.5 &amp; 0.5
\end{bmatrix}.\]</span></p>
<p><span class="math display">\[K_3 = \begin{bmatrix}
0.1 &amp; 0.9  \\[0.1em]
0.9 &amp; 0.1
\end{bmatrix}.\]</span></p>
<ol style="list-style-type: lower-alpha">
<li>Show that all three Markov Chains have a unique stationary distribution and that it is the same distribution for all three.</li>
<li>Let <span class="math inline">\(X\)</span> be a random variable distributed according to the distribution from (a). Compute <span class="math inline">\(E[X^2]\)</span>.</li>
<li>Estimate the expectation from (b) using 100 draws from the first Markov Chain. Plot the values of <span class="math inline">\(X^2\)</span> for all samples over time (note that this is called a traceplot. Compute the lag 1 autocorrelation. Estimate the approximation error (incorrectly in this case) by dividing the squared root of the variance with the squared root of the number of samples. Now estimate it better by adding to the variance twice the sum of all covariances, before taking the squared root and dividing with the squared root of the number of samples. Compute the Effective Sample Size, which is just the actual sample size multiplied with the ratio between the naive variance and the corrected variance.</li>
<li>Repeat (d) for the other two Markov Chains and discuss.
</div>
</li>
</ol>
<div class="fold">

<div class="solution">
<p> <span class="solution"><em>Solution. </em></span>  a. All three chains are finite state space and irreducible, so they all have a unique stationary distribution. From the symmetry of the transition matrices we can guess that the distribution also has to be symmetrical and that only leaves us with [0.5, 0.5]. We can quickly check by multiplying with each transition matrix that this is indeed the unique stationary distribution of all three.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li><p><span class="math inline">\(E[X^2] = 1^2 0.5 + 2^2 0.5 = 2.5\)</span>.</p></li>
<li>We can reuse the move() function from the first problem and just write a new rule:</li>
</ol>
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (x <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) x_new &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.9</span>, <span class="fl">0.1</span>))
  <span class="cf">if</span> (x <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) x_new &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>))
  x_new
}

x &lt;-<span class="st"> </span><span class="kw">move</span>(rule_<span class="dv">1</span>, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">m =</span> <span class="dv">100</span>)
<span class="kw">mean</span>(x<span class="op">^</span><span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 1.742574</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(x<span class="op">^</span><span class="dv">2</span>)</code></pre></div>
<p><img src="bookdown-ma2_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(x<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">100</span>) <span class="co"># naive estimate of MC error</span></code></pre></div>
<pre><code>## [1] 0.130118</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">acf</span>(x<span class="op">^</span><span class="dv">2</span>, <span class="dt">plot =</span> F)<span class="op">$</span>acf[<span class="dv">2</span>] <span class="co"># lag 1 autocorrelation</span></code></pre></div>
<pre><code>## [1] 0.8372694</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acov &lt;-<span class="st"> </span><span class="kw">acf</span>(x<span class="op">^</span><span class="dv">2</span>, <span class="dt">type =</span> <span class="st">&quot;covariance&quot;</span>, <span class="dt">plot =</span> F)<span class="op">$</span>acf
<span class="kw">sqrt</span>(acov[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(acov[<span class="op">-</span><span class="dv">1</span>])) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">100</span>) <span class="co"># better estimate of MC error</span></code></pre></div>
<pre><code>## [1] 0.3517387</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">var</span>(x<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>(acov[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(acov[<span class="op">-</span><span class="dv">1</span>])) <span class="co"># ESS</span></code></pre></div>
<pre><code>## [1] 13.68467</code></pre>
<p>``` We can see how the simple estimate of approximation error fails us when our Monte Carlo is based on dependent (autocorrelated) samples. If we compute it correctly by taking into account autocorrelation, we will see that our MC error is high and that we need to take more samples. This is also identified through ESS, which is just a tenth of the actual sample size. d. Is left to the reader.</p>
</div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="montecarlo.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="MCMC.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
